<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Control de Finanzas Personal</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 min-h-screen">
  <!-- Navbar -->
  <nav class="bg-blue-900 text-white px-4 py-3 flex flex-col md:flex-row md:items-center md:justify-between shadow">
    <div class="flex items-center mb-2 md:mb-0">
      <span class="text-2xl mr-2">💰</span>
      <span class="font-bold text-xl">Control de Finanzas Personal</span>
    </div>
    <div class="flex space-x-2">
      <button class="tab-btn px-4 py-2 rounded bg-white text-blue-900 font-semibold focus:outline-none" data-tab="resumen">Resumen</button>
      <button class="tab-btn px-4 py-2 rounded hover:bg-blue-800" data-tab="presupuesto">Presupuesto</button>
      <button class="tab-btn px-4 py-2 rounded hover:bg-blue-800" data-tab="gastos">Gastos Diarios</button>
      <button class="tab-btn px-4 py-2 rounded hover:bg-blue-800" data-tab="reportes">Reportes</button>
    </div>
  </nav>

  <div class="max-w-5xl mx-auto py-8 px-2">
    <!-- Resumen -->
    <section id="resumen" class="tab-section">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
        <div class="bg-white rounded-lg shadow p-6 flex flex-col items-center">
          <span class="text-2xl">🪙</span>
          <span class="font-semibold text-lg mt-2">Ingresos Mensuales</span>
          <span id="ingresosResumen" class="text-green-600 text-2xl font-bold mt-2">$0</span>
        </div>
        <div class="bg-white rounded-lg shadow p-6 flex flex-col items-center">
          <span class="text-2xl">🪙</span>
          <span class="font-semibold text-lg mt-2">Gastos Fijos</span>
          <span id="gastosFijosResumen" class="text-red-600 text-2xl font-bold mt-2">$0</span>
        </div>
        <div class="bg-white rounded-lg shadow p-6 flex flex-col items-center">
          <span class="text-2xl">🛒</span>
          <span class="font-semibold text-lg mt-2">Gastos Variables</span>
          <span id="gastosVariablesResumen" class="text-red-600 text-2xl font-bold mt-2">$0</span>
        </div>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="bg-white rounded-lg shadow p-6 flex flex-col items-center">
          <span class="text-2xl">📊</span>
          <span class="font-semibold text-lg mt-2">Balance</span>
          <span id="balanceResumen" class="text-blue-600 text-2xl font-bold mt-2">$0</span>
        </div>
        <div class="bg-blue-100 rounded-lg shadow p-6 flex-1 flex flex-col items-center">
          <span class="font-semibold">Hoy</span>
          <span id="hoyResumen" class="text-blue-700 text-xl font-bold mt-2">$0</span>
        </div>
        <div class="bg-blue-100 rounded-lg shadow p-6 flex-1 flex flex-col items-center">
          <span class="font-semibold">Esta Semana</span>
          <span id="semanaResumen" class="text-blue-700 text-xl font-bold mt-2">$0</span>
        </div>
        <div class="bg-blue-100 rounded-lg shadow p-6 flex-1 flex flex-col items-center md:col-span-1">
          <span class="font-semibold">Este Mes</span>
          <span id="mesResumen" class="text-blue-700 text-xl font-bold mt-2">$0</span>
        </div>
      </div>
    </section>

    <!-- Presupuesto -->
    <section id="presupuesto" class="tab-section hidden">
      <div class="bg-white p-6 rounded-lg shadow">
        <h2 class="text-xl font-semibold mb-4">Presupuesto (próximamente)</h2>
        <p class="text-gray-600">Aquí podrás definir y editar tu presupuesto mensual.</p>
      </div>
    </section>

    <!-- Gastos Diarios -->
    <section id="gastos" class="tab-section hidden">
      <div class="bg-white p-6 rounded-lg shadow mb-8">
        <h2 class="text-xl font-semibold mb-4">Registrar Gasto Diario</h2>
        <form id="gastoForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <input type="date" id="fecha" required class="border p-2 rounded" />
          <input type="text" id="categoria" placeholder="Categoría" required class="border p-2 rounded" />
          <input type="text" id="descripcion" placeholder="Descripción" required class="border p-2 rounded" />
          <input type="number" id="monto" placeholder="Monto" required class="border p-2 rounded" />
          <input type="text" id="medioPago" placeholder="Medio de Pago" required class="border p-2 rounded" />
          <input type="text" id="observaciones" placeholder="Observaciones" class="border p-2 rounded" />
          <button type="submit" class="col-span-1 md:col-span-2 bg-blue-600 text-white py-2 rounded hover:bg-blue-700">Agregar Gasto</button>
        </form>
      </div>
      <div class="bg-white p-6 rounded-lg shadow mb-8">
        <h2 class="text-xl font-semibold mb-4">Gastos Registrados</h2>
        <div class="overflow-x-auto">
          <table class="min-w-full text-sm text-gray-700" id="tablaGastos">
            <thead>
              <tr class="bg-blue-100">
                <th class="p-2">Fecha</th>
                <th class="p-2">Categoría</th>
                <th class="p-2">Descripción</th>
                <th class="p-2">Monto</th>
                <th class="p-2">Medio de Pago</th>
                <th class="p-2">Observaciones</th>
                <th class="p-2">Eliminar</th>
              </tr>
            </thead>
            <tbody id="gastosBody">
              <!-- Gastos se insertan aquí -->
            </tbody>
          </table>
        </div>
      </div>
      <div class="bg-white p-6 rounded-lg shadow">
        <h2 class="text-xl font-semibold mb-4">Totales por Categoría</h2>
        <ul id="totalesCategoria" class="space-y-2"></ul>
      </div>
    </section>

    <!-- Reportes -->
    <section id="reportes" class="tab-section hidden">
      <div class="bg-white p-6 rounded-lg shadow">
        <h2 class="text-xl font-semibold mb-4">Reportes (próximamente)</h2>
        <p class="text-gray-600">Aquí podrás ver gráficos y reportes de tus finanzas.</p>
      </div>
    </section>
  </div>

  <script>
    // Tabs
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('bg-white', 'text-blue-900'));
        this.classList.add('bg-white', 'text-blue-900');
        const tab = this.getAttribute('data-tab');
        document.querySelectorAll('.tab-section').forEach(sec => sec.classList.add('hidden'));
        document.getElementById(tab).classList.remove('hidden');
      });
    });

    // Utilidades para LocalStorage
    function obtenerGastos() {
      return JSON.parse(localStorage.getItem('gastos') || '[]');
    }
    function guardarGastos(gastos) {
      localStorage.setItem('gastos', JSON.stringify(gastos));
    }

    // Renderizar tabla de gastos
    function renderizarGastos() {
      const gastos = obtenerGastos();
      const tbody = document.getElementById('gastosBody');
      if (!tbody) return;
      tbody.innerHTML = '';
      gastos.forEach((gasto, idx) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="p-2">${gasto.fecha}</td>
          <td class="p-2">${gasto.categoria}</td>
          <td class="p-2">${gasto.descripcion}</td>
          <td class="p-2">$${gasto.monto.toLocaleString()}</td>
          <td class="p-2">${gasto.medioPago}</td>
          <td class="p-2">${gasto.observaciones || ''}</td>
          <td class="p-2"><button onclick="eliminarGasto(${idx})" class="text-red-600 hover:underline">Eliminar</button></td>
        `;
        tbody.appendChild(tr);
      });
      renderizarTotales();
    }

    // Renderizar totales por categoría
    function renderizarTotales() {
      const gastos = obtenerGastos();
      const totales = {};
      gastos.forEach(g => {
        totales[g.categoria] = (totales[g.categoria] || 0) + Number(g.monto);
      });
      const ul = document.getElementById('totalesCategoria');
      if (!ul) return;
      ul.innerHTML = '';
      Object.entries(totales).forEach(([cat, total]) => {
        const li = document.createElement('li');
        li.textContent = `${cat}: $${total.toLocaleString()}`;
        ul.appendChild(li);
      });
    }

    // Eliminar gasto
    function eliminarGasto(idx) {
      const gastos = obtenerGastos();
      gastos.splice(idx, 1);
      guardarGastos(gastos);
      renderizarGastos();
      renderizarResumen();
    }

    // Manejar formulario
    const gastoForm = document.getElementById('gastoForm');
    if (gastoForm) {
      gastoForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const gasto = {
          fecha: document.getElementById('fecha').value,
          categoria: document.getElementById('categoria').value,
          descripcion: document.getElementById('descripcion').value,
          monto: Number(document.getElementById('monto').value),
          medioPago: document.getElementById('medioPago').value,
          observaciones: document.getElementById('observaciones').value
        };
        const gastos = obtenerGastos();
        gastos.push(gasto);
        guardarGastos(gastos);
        this.reset();
        renderizarGastos();
        renderizarResumen();
      });
    }

    // Renderizar resumen
    function renderizarResumen() {
      const gastos = obtenerGastos();
      let ingresos = 0;
      let gastosFijos = 0;
      let gastosVariables = 0;
      let hoy = 0, semana = 0, mes = 0;
      const hoyFecha = new Date().toISOString().slice(0, 10);
      const now = new Date();
      const primerDiaSemana = new Date(now.setDate(now.getDate() - now.getDay() + 1)).toISOString().slice(0, 10);
      const primerDiaMes = new Date(new Date().getFullYear(), new Date().getMonth(), 1).toISOString().slice(0, 10);
      gastos.forEach(g => {
        // Puedes personalizar la lógica de ingresos/gastos fijos/variables según tus categorías
        if (g.categoria.toLowerCase().includes('ingreso')) ingresos += Number(g.monto);
        else if (g.categoria.toLowerCase().includes('fijo')) gastosFijos += Number(g.monto);
        else gastosVariables += Number(g.monto);
        if (g.fecha === hoyFecha) hoy += Number(g.monto);
        if (g.fecha >= primerDiaSemana) semana += Number(g.monto);
        if (g.fecha >= primerDiaMes) mes += Number(g.monto);
      });
      document.getElementById('ingresosResumen').textContent = `$${ingresos.toLocaleString()}`;
      document.getElementById('gastosFijosResumen').textContent = `$${gastosFijos.toLocaleString()}`;
      document.getElementById('gastosVariablesResumen').textContent = `$${gastosVariables.toLocaleString()}`;
      document.getElementById('balanceResumen').textContent = `$${(ingresos - gastosFijos - gastosVariables).toLocaleString()}`;
      document.getElementById('hoyResumen').textContent = `$${hoy.toLocaleString()}`;
      document.getElementById('semanaResumen').textContent = `$${semana.toLocaleString()}`;
      document.getElementById('mesResumen').textContent = `$${mes.toLocaleString()}`;
    }

    // Inicializar
    renderizarGastos();
    renderizarResumen();
    // Mostrar la pestaña de resumen por defecto
    document.querySelectorAll('.tab-section').forEach(sec => sec.classList.add('hidden'));
    document.getElementById('resumen').classList.remove('hidden');
    document.querySelector('.tab-btn[data-tab="resumen"]').classList.add('bg-white', 'text-blue-900');
  </script>
</body>
</html>
